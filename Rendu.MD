# üìÑ Rapport de Projet d'Infrastructure R√©seau et Services

Ce document pr√©sente la configuration, le d√©ploiement et la validation de l'infrastructure r√©seau de l'entreprise, y compris la mise en place des services DNS, Web, et la strat√©gie de r√©silience (Sauvegarde/Restauration).

## I. Architecture et Adressage R√©seau

L'infrastructure est bas√©e sur un r√©seau priv√© isol√© (`Host-Only Network`) et utilise la machine **Routeur** comme passerelle (NAT) vers Internet.

### 1. Plan d'Adressage

| R√¥le de la Machine | Adresse IP LAN | Interface LAN |
| :--- | :--- | :--- |
| **Routeur / DNS** | `192.168.56.3` | `enp0s8` |
| **Serveur Web** | `192.168.56.10` | `enp0s8` |
| **Client de Test** | `192.168.56.96` | `enp0s8` |

## II. S√©curit√© R√©seau (Firewall Iptables)

Les politiques par d√©faut sont `DROP` et seules les communications essentielles sont autoris√©es.

### 1. R√®gles du Routeur (`192.168.56.3`)

* Politiques : `INPUT DROP`, `FORWARD DROP`, `OUTPUT ACCEPT`.
* Configuration : R√®gles NAT et `FORWARD` pour autoriser le trafic LAN vers WAN.

### 2. R√®gles du Serveur Web (`192.168.56.10`)

* Politique : `INPUT DROP`.
* Configuration : Ouverture des ports `22` (SSH) et `80` (HTTP).

## III. D√©ploiement des Services DNS et Web

### 1. Service DNS (BIND9 sur le Routeur)

BIND9 g√®re la zone `entreprise.local`. L'enregistrement cl√© est :
* `web.entreprise.local` $\rightarrow$ `192.168.56.10`

### 2. Serveur Web (Nginx Virtual Host)

Le serveur Web utilise Nginx avec un Virtual Host pointant vers `/var/www/entreprise.local/html` pour le domaine `web.entreprise.local`.

* **Validation finale :** `curl http://web.entreprise.local` retourne le contenu personnalis√©.

## IV. Strat√©gie de R√©silience (Sauvegarde et Restauration)

### 1. Strat√©gie de Sauvegarde Automatis√©e

* **M√©thode :** `rsync` via SSH (Cl√© SSH sans *passphrase*).
* **Destination :** Le **Routeur** (`192.168.56.3`) dans `/mnt/backups/webserver`.
* **Automatisation :** T√¢che `cron` quotidienne pour `root` (`0 2 * * *`).

#### Script de Sauvegarde (`/usr/local/bin/backup_web.sh`)

```bash
#!/bin/bash
USER="stark"; HOST="192.168.56.3"; DESTINATION="/mnt/backups/webserver"
IDENTITY_FILE="/home/stark/.ssh/id_rsa" 

CRITICAL_FILES=(
    "/var/www/entreprise.local"   # Contenu Web Personnalis√©
    "/etc/nginx"                  # Configuration Nginx
    # ... autres fichiers critiques
)

for FILE in "${CRITICAL_FILES[@]}"; do
    sudo rsync -avzu -e "ssh -i $IDENTITY_FILE" "$FILE" "$USER"@"$HOST":"$DESTINATION"
done 
```

# 2. Proc√©dure de Restauration (Reprise apr√®s Sinistre)
La proc√©dure de restauration est d√©clench√©e suite √† une panne du Serveur Web et vise √† restaurer le service avec un minimum d'interruption en maintenant l'adresse IP (192.168.56.10).

## √âtapes de la Restauration

1. D√©ploiement du Remplacement : √âteindre la VM Serveur Web d√©faillante. D√©ployer une nouvelle VM (via clonage de l'ancienne) en conservant l'IP 192.168.56.10.

2. R√©tablissement de la Confiance SSH : Sur la nouvelle VM, g√©n√©rer une nouvelle paire de cl√©s SSH (ssh-keygen) pour l'utilisateur stark et copier la cl√© publique sur le Routeur (ssh-copy-id).

3. Pr√©paration du Script : S'assurer que le script /usr/local/bin/restore_web.sh est pr√©sent et ex√©cutable sur la nouvelle VM.

4. Ex√©cution de la Restauration : Lancer le script pour rapatrier les donn√©es et recharger les services.

5. Validation : V√©rifier l'acc√®s au site Web (curl http://web.entreprise.local).
Script de Restauration (/usr/local/bin/restore_web.sh)



### Le serveur doit avoir la m√™me IP (192.168.56.10) et une cl√© SSH valide.
USER="stark"; HOST="192.168.56.3"; SOURCE="/mnt/backups/webserver"
IDENTITY_FILE="/home/stark/.ssh/id_rsa"; WEB_CONTENT="/var/www/entreprise.local"

### 1. Restauration des fichiers du site (avec suppression des fichiers non sauvegard√©s)
echo "1/3. Restauration du contenu web et des Vhosts Nginx..."
sudo rsync -avzu --delete -e "ssh -i $IDENTITY_FILE" "$USER"@"$HOST":"$SOURCE"/entreprise.local/ "$WEB_CONTENT"/

### 2. Restauration des configurations (√©crasement des fichiers locaux)
echo "2/3. Restauration des fichiers de configuration..."
sudo rsync -avzu -e "ssh -i $IDENTITY_FILE" "$USER"@"$HOST":"$SOURCE"/etc/nginx/ /etc/nginx/
sudo rsync -avzu -e "ssh -i $IDENTITY_FILE" "$USER"@"$HOST":"$SOURCE"/etc/iptables/ /etc/iptables/

### 3. Application des nouvelles configurations
echo "3/3. Application des nouvelles configurations..."
sudo netfilter-persistent reload 
sudo systemctl restart nginx     

echo "--- Restauration termin√©e ---"